app.controller("HomeCtrl",["$scope","$resource","$cookieStore","$http",function($scope,$resource,$cookieStore,$http){if($cookieStore.get("old")===undefined){$cookieStore.put("old",0)}$scope.choices=[{id:0,content:"Само новите теми",name:"New"},{id:1,content:"Само старите теми",name:"Old"},{id:2,content:"Само с нови коментари",name:"Comments"},{id:3,content:"Всички теми",name:"All"}];$scope.selectedChoice=$scope.choices[$cookieStore.get("old")!==undefined?$cookieStore.get("old"):0];$scope.$watch("selectedChoice",function(newValue,oldValue){$scope.nothing=false;$scope.search="";$cookieStore.remove("old");$cookieStore.put("old",newValue.id);pos=0;$scope.products=load(pos,$scope.step,newValue.id,$scope.search);window.scrollTo(0,0)});$scope.showme=false;$scope.search="";var pos=0;$scope.step=6;$scope.products=load(pos,$scope.step,$scope.selectedChoice,$scope.search);function load(skip,limit,kind,search){var res=$resource("/api");return res.query({s:skip,l:limit,"new":kind,search:search})}$scope.sel=function(){$scope.goSearch()};$scope.ent=function(){$scope.goSearch()};$scope.goSearch=function(){window.scrollTo(0,0);$scope.nothing=false;$scope.search=$scope.search.trim();pos=0;$http.get("/api",{params:{s:pos,l:$scope.step,"new":3,search:$scope.search}}).success(function(data,status,error,config){if(data.length>0){return $scope.products=data}$scope.nothing=true;$scope.products=""}).error(function(err){console.log("Resource reading failed: "+err)});var width=window.innerWidth>0?window.innerWidth:screen.width;if(width<400){$scope.search=$scope.search.substr(0,20)}};$scope.getProd=function(val){if(val=="zlatozar"){$scope.showme=true}else{$scope.showme=false}return $http.post("/api/search",{search:val}).then(function(response){var width=window.innerWidth>0?window.innerWidth:screen.width;var length=width<400?30:55;var result=response.data;if(result!==undefined){for(i=0;i<result.length;i++){if(result[i].length>length){result[i]=result[i].substr(0,length)}}}return response.data})};$scope.nothing=false;$scope.info="Засега няма информация за това което търсите!";$scope.dbClear=function(){if(confirm("Всички снимки останали без прикачени теми ще бъдат изтрити завинаги!\nДа го направи ли???")){$resource("/api/clear").query();alert("Базата данни е почистена!!!")}};$scope.prev=function(){if(pos>=$scope.step){pos=pos-$scope.step;load(pos,$scope.step,$scope.selectedChoice.id,$scope.search).$promise.then(function(result){$scope.products=result;window.scrollTo(0,0)})}};$scope.next=function(){pos=pos+$scope.step;load(pos,$scope.step,$scope.selectedChoice.id,$scope.search).$promise.then(function(result){if(result.length===0){pos=pos-$scope.step}else{$scope.products=result;window.scrollTo(0,0)}})};$scope.name=function(name){if(name.length<=17)return name;return name.substr(0,17)+" ..."};$scope.getNumber=function(el){var i=0;el.forEach(function(ggg){if(!ggg.flagIsNew){i++}});return i};$scope.giveMeThumb=function(img){var random=(new Date).toString();$scope.app={imageUrl:"/thumb/"+img};var random=(new Date).toString();return $scope.app.imageUrl+"?df="+random}}]);