app.controller("ProductEditCtrl",["$scope","$routeParams","$resource","productsCRUD","$modal","$location",function($scope,$routeParams,$resource,productsCRUD,$modal,$location){window.scrollTo(0,0);$scope.readyForUpdate=false;$scope.onoff=false;$scope.rotationInProgres=false;$scope.removingInProgres=false;$scope.banningInProgres=false;$scope.showMe=function(){if($scope.onoff){return}var modalInstance=$modal.open({templateUrl:"/p/partials/showMe",controller:"ShowMeCtrl",resolve:{message:function(){return $scope.Product.thumbnail}}});modalInstance.result.then(function(result){if(result=="close"){$modalInstance.dismiss("close")}})};var p=$resource("/api/product/:id",{id:$routeParams.id});p.get().$promise.then(function(product){$scope.Product=product;var random=(new Date).toString();$scope.app={imageUrl:"/thumb/"+$scope.Product.thumbnail};var random=(new Date).toString();$scope.imageSource=$scope.app.imageUrl+"?df="+random});$scope.rotateImg=function(){if(confirm("Да завъртя ли снимката???")){$scope.rotationInProgres=true;$scope.onoff=true;$scope.myPromise=$resource("/rotateImage/:id",{id:$scope.Product.thumbnail}).get().$promise.then(function(product){$scope.app={imageUrl:"/thumb/"+$scope.Product.thumbnail};var random=(new Date).toString();$scope.imageSource=$scope.app.imageUrl+"?df="+random;$scope.onoff=false;$scope.rotationInProgres=false})}};$scope.removeImg=function(){if(confirm("Да премахна ли снимката???")){$scope.removingInProgres=true;$scope.onoff=true;$scope.myPromise=$resource("/removeImage/:id",{id:$scope.Product.thumbnail}).get().$promise.then(function(product){$scope.app={imageUrl:"/thumb/"+$scope.Product.thumbnail};var random=(new Date).toString();$scope.imageSource=$scope.app.imageUrl+"?df="+random;$scope.onoff=false;$scope.removingInProgres=false})}};$scope.bannedImg=function(){if(confirm("Да забраня/банирам ли снимката???")){$scope.banningInProgres=true;$scope.onoff=true;$scope.myPromise=$resource("/banImage/:id",{id:$scope.Product.thumbnail}).get().$promise.then(function(product){$scope.app={imageUrl:"/thumb/"+$scope.Product.thumbnail};var random=(new Date).toString();$scope.imageSource=$scope.app.imageUrl+"?df="+random;$scope.onoff=false;$scope.banningInProgres=false})}};$scope.changeForUpdate=function(){$scope.readyForUpdate=true};$scope.updateProduct=function(){$scope.readyForUpdate=false;productsCRUD.update($scope.Product);alert("Всички промени са актуализирани!")};$scope.deleteProduct=function(){if(confirm("Така ще изтриете цялата тема!!!?")){var p=$resource("/api/delete/:id",{id:$routeParams.id});p.get().$promise.then(function(product){});$location.path("/")}};$scope.removeCommentFromPros=function(ele){if(confirm("Желаете ли да премахнете този коментар?")){$scope.readyForUpdate=true;var index=$scope.Product.pros.indexOf(ele);if(index>-1){$scope.Product.pros.splice(index,1)}}};$scope.removeCommentFromCons=function(ele){if(confirm("Желаете ли да премахнете този коментар?")){$scope.readyForUpdate=true;var index=$scope.Product.cons.indexOf(ele);if(index>-1){$scope.Product.cons.splice(index,1)}}};$scope.$on("$routeChangeStart",function(next,current){if($scope.readyForUpdate){if(confirm("Има промени, които не са актуализирани!!!\nИзкате ли да бъдат потвърдени?")){$scope.updateProduct()}}})}]);